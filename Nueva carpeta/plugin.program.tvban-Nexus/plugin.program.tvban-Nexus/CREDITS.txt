Many thanks to drinfernoo and slamious who did the real work!